<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>后端 - Saiblo 平台开发维护手册</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u540e\u7aef";
    var mkdocs_page_input_path = "dev/backend.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Saiblo 平台开发维护手册</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">概览</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">运维手册</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../ops/deployment/">平台部署</a>
                </li>
                <li class="">
                    
    <a class="" href="../../ops/proxy/">反向代理</a>
                </li>
                <li class="">
                    
    <a class="" href="../../ops/auto_match/">定时对局抽取</a>
                </li>
                <li class="">
                    
    <a class="" href="../../ops/judger/">评测机部署</a>
                </li>
                <li class="">
                    
    <a class="" href="../../ops/wiki/">Wiki 管理</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">开发手册</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../arch/">平台架构</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">后端</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#_1">后端</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#_2">模型</a></li>
        
            <li><a class="toctree-l4" href="#_24">权限</a></li>
        
            <li><a class="toctree-l4" href="#_25">视图</a></li>
        
            <li><a class="toctree-l4" href="#_26">序列化</a></li>
        
            <li><a class="toctree-l4" href="#_27">信号</a></li>
        
            <li><a class="toctree-l4" href="#_28">定时任务</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../judger/">评测端</a>
                </li>
                <li class="">
                    
    <a class="" href="../frontend2backend/">前端与后端</a>
                </li>
                <li class="">
                    
    <a class="" href="../frontend2judger/">前端与评测端</a>
                </li>
                <li class="">
                    
    <a class="" href="../backend2judger/">后端与评测端</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">前端开发手册</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../frontend/website-frontend/">概述</a>
                </li>
                <li class="">
                    
    <a class="" href="../../frontend/website-frontend-user/">用户系统</a>
                </li>
                <li class="">
                    
    <a class="" href="../../frontend/website-frontend-contest/">比赛系统</a>
                </li>
                <li class="">
                    
    <a class="" href="../../frontend/website-frontend-game/">游戏系统</a>
                </li>
                <li class="">
                    
    <a class="" href="../../frontend/website-frontend-group/">小组系统</a>
                </li>
                <li class="">
                    
    <a class="" href="../../frontend/website-frontend-component/">部件</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Saiblo 平台开发维护手册</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>开发手册 &raquo;</li>
        
      
    
    <li>后端</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="_1">后端</h1>
<p>后端主要用Django REST架构完成，作为了一个API服务器为前端提供数据，为此使用到以下<strong>核心库</strong>：</p>
<ul>
<li>Django：基本框架库</li>
<li>Django REST Framework：提供REST接口</li>
<li>Simple JWT：提供JWT认证服务</li>
<li>Django Crontab：定时执行任务，用于跑天梯赛等</li>
</ul>
<h2 id="_2">模型</h2>
<p>作为Django下开发数据库的数据库的基础，本着精简的原则设计了各种model，在backend/saiblo/models文件夹中定义了所有模型，下面在描述模型所在文件时均是相对该文件夹的相对路径。</p>
<p>注：如无特殊说明，模型将继承自<code>Django.db.models.Model</code>，且默认包含了自增主键字段<code>id</code>。</p>
<h3 id="user">User</h3>
<p>继承自<code>AbstrackUser</code>，作为网站的用户模型，在user.py中。</p>
<h4 id="_3">字段</h4>
<p><code>AbstrackUser</code>本来包含以下字段：</p>
<ul>
<li>username：用户名，仅限字母与数字，唯一</li>
<li>last_login：最近登陆时间，自动更新</li>
<li>is_superuser：bool，是否是超级用户</li>
<li>first_name &amp; last_name：<strong>未使用</strong></li>
<li>email：邮箱号，唯一</li>
<li>is_staff：bool，是否有Django管理网站访问权限</li>
<li>is_active：bool，用户是否已激活</li>
<li>date_joined：注册时间，自动生成</li>
</ul>
<p>此外，<code>User</code>额外添加了以下字段：</p>
<ul>
<li>name：真实姓名，支持汉字</li>
<li>nickname：昵称，目前<strong>未使用</strong></li>
<li>biography：个人简介</li>
<li>school：学校</li>
<li>department：院系</li>
<li>sex：性别，必须是[”男“，”女“，”保密“]之一</li>
<li>email_md5：email的md5值，单独存储它以便于前端加载头像</li>
</ul>
<h3 id="group">Group</h3>
<p>网站的小组模型，在group.py中。</p>
<h4 id="_4">字段</h4>
<ul>
<li>name：小组名</li>
<li>introduction：小组简介</li>
<li>reason：小组创建理由</li>
<li>size：小组人数，该字段会在小组save时自动变更</li>
<li>creator：小组创建者，是一个指向<code>User</code>的多对一外键</li>
<li>managers：小组管理员，是一个指向<code>User</code>的多对多外键</li>
<li>members：小组普通成员，是一个指向<code>User</code>的多对多外键</li>
<li>applicants：小组的申请者，是一个指向<code>User</code>的多对多外键，通过<code>Application</code>记录</li>
<li>created_time：小组创建时间，自动生成</li>
<li>is_permitted：bool，小组是否已被网站管理员批准创建，True为过审，False为驳回，None为未处理</li>
<li>auto_pass：bool，小组是否自动处理申请(自动处理即自动通过)</li>
<li>accept_application：bool，小组是否允许被申请</li>
<li>visible：bool，小组是否可见，仅一些逻辑上的小组会处于不可见状态</li>
</ul>
<h4 id="_5">说明</h4>
<ol>
<li>accept_application设置为Flase时小组为”仅允许管理员邀请加入“，当它设置为True时auto_pass才有意义，此情况下auto_pass设置为True表示”允许任何人加入“，Flase表示”需要管理员审核后加入“。</li>
<li>creator、managers、members所包含的User互斥，它们数量的总和为小组人数(其中creator只有一个且不可更改)，类似于QQ群的管理结构。</li>
</ol>
<h3 id="application">Application</h3>
<p>成员加入小组的申请的模型，在application.py中。</p>
<h4 id="_6">字段</h4>
<ul>
<li>message：申请理由</li>
<li>user：申请的用户，指向User的多对一外键</li>
<li>group：申请的小组，指向Group的多对一外键</li>
<li>time：申请/批准时间，自动更新</li>
<li>is_permitted：bool，申请是否通过，True为通过，False为拒绝，None为未审核</li>
</ul>
<h4 id="_7">约束</h4>
<ul>
<li>按time降序排序</li>
<li>(user, group)构成一组唯一元组以及索引，即一个用户对一个小组最多只能存在一个申请，仅当小组被解散或者用户被踢时会删除申请，拒绝后重新申请不会生成新的申请</li>
</ul>
<h3 id="notice">Notice</h3>
<p>小组发布公告的模型，在notice.py中。</p>
<h4 id="_8">字段</h4>
<ul>
<li>title：公告标题</li>
<li>content：公告内容，富文本</li>
<li>pulisher：公告发布者，是一个指向<code>User</code>的多对一外键</li>
<li>last_editor：公告最后编辑者，是一个指向<code>User</code>的多对一外键</li>
<li>time：公告最后更新时间，自动更新</li>
<li>group：公告所属小组，是一个指向<code>Group</code>的多对一外键</li>
</ul>
<h4 id="_9">约束</h4>
<ul>
<li>按time降序排序</li>
</ul>
<h3 id="game">Game</h3>
<p>游戏的模型，在game.py中。</p>
<h4 id="_10">字段</h4>
<ul>
<li>name：游戏名，字母和数字</li>
<li>alias：别称，一般为中文全称</li>
<li>introduction：游戏介绍，富文本</li>
<li>creator：创建者，是一个指向<code>User</code>的多对一外键</li>
<li>managers：管理员，是一个指向<code>User</code>的多对多外键</li>
<li>game_file：游戏播放器等文件包</li>
<li>create_time：创建时间，自动生成</li>
<li>update_time：更新时间，自动更新</li>
<li>is_permitted：bool，游戏是否过审，True为过审，False为驳回，None为未审核</li>
<li>player_number：游戏支持的人数，字符串，里面包含游戏支持的可能人数，用空格隔开，如"2 4 6 8"</li>
<li>has_replay_player：bool，游戏是否能看回放</li>
<li>allow_watch：bool，游戏是否支持对局过程中观战</li>
<li>support_online_game：bool，游戏是否支持在线对局</li>
<li>quick_start：bool，游戏是否支持快速匹配人机模式</li>
<li>allow_remote：bool，游戏是否支持远程算力</li>
</ul>
<h3 id="entity">Entity</h3>
<p>智能体(或者俗称AI)的模型，在entity.py中。</p>
<h4 id="_11">字段</h4>
<ul>
<li>name：名称</li>
<li>user：用户，是一个指向<code>User</code>的多对一外键</li>
<li>game：游戏，是一个指向<code>Game</code>的多对一外键</li>
<li>next_version：下一个版本号，用单增的方法处理一个AI的各个版本号</li>
<li>created_time：创建时间，自动生成</li>
<li>language：编程语言，从枚举类<code>Language</code> 中选择，这个类可以继续扩展以支持新的语言</li>
</ul>
<h3 id="code">Code</h3>
<p>一个智能体具体某个版本代码的模型，在code.py中。</p>
<h4 id="_12">字段</h4>
<ul>
<li>id：一个uuid作为主键</li>
<li>code_file：代码文件</li>
<li>time：更新时间，自动更新</li>
<li>entity：所属智能体，是一个指向<code>Entity</code>的多对一外键</li>
<li>version：版本号，它只针对某一个具体智能体唯一</li>
<li>remark：注释</li>
<li>compile_status：编译状态，评测机给出，从Code类常量COMPILE_STATUS取值，目前是['未编译', '编译中', '编译成功', '编译失败']</li>
<li>compile_message：编译输出，评测机给出，主要用于查看报错信息</li>
</ul>
<h4 id="_13">约束</h4>
<ul>
<li>按time降序排序</li>
</ul>
<h3 id="contest">Contest</h3>
<p>比赛的模型，在contest.py中。</p>
<h4 id="_14">字段</h4>
<ul>
<li>name：比赛名</li>
<li>game：游戏，是一个指向<code>Game</code>的多对一外键</li>
<li>group：小组，是一个指向<code>Group</code>的多对一外键</li>
<li>begin_time：开始时间</li>
<li>end_time：结束时间</li>
<li>create_time：创建时间，自动生成</li>
<li>introduction：简介，富文本</li>
<li>promoter：发起人，是一个指向<code>User</code>的多对一外键</li>
<li>format：赛制，从Contest类的常量成员<code>FORMAT</code>中取值，目前为['cycle', 'ladder', 'free', 'auto']</li>
</ul>
<h4 id="_15">说明</h4>
<ol>
<li>后端支持比赛随时修改时间</li>
<li>为了自洽性，将游戏的天梯设置为隐性的比赛天梯，赛制为<code>auto</code>，因此后文<code>ActiveCode</code>在设置时会生成对应的<code>Paritipation</code></li>
</ol>
<h3 id="participation">Participation</h3>
<p>用户参加比赛的记录信息的模型，在contest.py中。</p>
<h4 id="_16">字段</h4>
<ul>
<li>contest：比赛，是一个指向<code>Contest</code>的多对一外键</li>
<li>user：用户，是一个指向<code>User</code>的多对一外键</li>
<li>code：代码，是一个指向<code>Code</code>的多对一外键</li>
<li>socre：天梯分</li>
<li>joined_time：加入时间，自动生成</li>
</ul>
<h4 id="_17">约束</h4>
<ul>
<li>按score升序排序</li>
<li>对于一组('contest', 'user')其Participation唯一</li>
</ul>
<h4 id="_18">说明</h4>
<ol>
<li>当用户加入比赛时会自动生成相应的Participation，退出(取消出战AI)时会删除该记录，此时天梯分将被清除</li>
<li>用户参加比赛(指定比赛的出战AI)时只需要Pariticipation记录即可，而对游戏设置出战AI则需要用到下面的ActivateCode</li>
</ol>
<h3 id="activatecode">ActivateCode</h3>
<p>表示游戏的出战AI的模型，在code.py中。</p>
<h4 id="_19">字段</h4>
<ul>
<li>user：用户，是一个指向<code>User</code>的多对一外键</li>
<li>game：游戏，是一个指向<code>Game</code>的多对一外键</li>
<li>code：代码，是一个指向<code>Code</code>的多对一外键</li>
<li>time：更新时间，自动更新</li>
<li>part：天梯记录信息，是一个指向<code>Participation</code>的一对一外键，可以为空</li>
</ul>
<h4 id="_20">约束</h4>
<ul>
<li>对于一组('user', 'game')其ActivateCode是唯一的</li>
</ul>
<h3 id="match">Match</h3>
<p>记录对局的模型，在match.py中。</p>
<h4 id="_21">字段</h4>
<ul>
<li>players：对局用户，是一个指向<code>User</code>的多对多外键</li>
<li>contest：比赛，是一个指向<code>Contest</code>的多对一外键，可以为空，表示这是游戏对局而非比赛对局</li>
<li>game：游戏，是一个指向<code>Game</code>的多对一外键</li>
<li>state：状态，评测机给出，从Match常量成员STATE取值，目前为['准备中', '评测中', '评测成功', '评测失败']</li>
<li>create_time：创建时间，自动生成</li>
<li>file：对局文件，评测机给出</li>
<li>message：评测字符串，评测机给出，包含了得分情况，需要后端根据通信格式解析</li>
</ul>
<h4 id="_22">约束</h4>
<ul>
<li>按create_time降序排序</li>
</ul>
<h3 id="playerinfo">PlayerInfo</h3>
<p>记录对局中各个选手得分情况的模型，在match.py中。</p>
<h4 id="_23">字段</h4>
<ul>
<li>code：代码，是一个指向<code>Code</code>的多对一外键，可以为空，表示这是玩家控制而非AI</li>
<li>user：用户，是一个指向<code>User</code>的多对一外键</li>
<li>match：对局，是一个指向<code>Match</code>的多对一外键</li>
<li>rank：排名</li>
<li>score：分数</li>
</ul>
<h3 id="contestinfo">ContestInfo</h3>
<p>用于记录一个对局关于比赛信息的模型，在match.py中。</p>
<p>疑似冗余，计划删除。</p>
<h2 id="_24">权限</h2>
<p>权限管理使用了<code>rest_framework.permissions</code>部分的内容，在backend/saiblo/permissions文件夹中包含了所有权限设定，均继承自<code>rest_framework.permissions.BasePermission</code>。关于权限的使用属于Django REST基础知识，这里仅仅按文件列举出目前包含的权限以及语义。</p>
<h3 id="applicationpy">application.py</h3>
<ul>
<li><code>IsApplicant</code>：判断用户是否是申请发起人，疑似冗余，计划删除。</li>
<li><code>IsApplicationGroupManager</code>：判断用户是否是申请目标小组的管理员，疑似冗余，计划删除。</li>
</ul>
<h3 id="codepy">code.py</h3>
<ul>
<li><code>IsEntityOwner</code>：判断用户是否是AI的拥有者。</li>
</ul>
<h3 id="contestpy">contest.py</h3>
<ul>
<li><code>IsActivateContest</code>：判断比赛是否可以被加入/更改AI，已经结束的比赛不能再设置AI，对于双败淘汰赛制开始后即不能设置AI。</li>
</ul>
<h3 id="gamepy">game.py</h3>
<ul>
<li><code>IsGameManger</code>：判断用户是否有游戏管理权限，包括管理员与创建者两种情况</li>
<li><code>IsGameCreator</code>：判断用户是否是游戏创建者</li>
</ul>
<h4 id="grouppy">group.py</h4>
<ul>
<li><code>NotInGroup</code>：判断用户是否不在小组中</li>
<li><code>IsgGroupMember</code>：判断用户是否在小组中</li>
<li><code>IsGroupManger</code>：判断用户是否有小组管理权限，包括管理员与创建者两种情况</li>
<li><code>IsGroupCreator</code>：判断用户是否是小组创建者</li>
<li><code>HasHigherPermission</code>：判断用户是否比目标用户有更高的小组权限，创建者&gt;管理员&gt;普通成员</li>
</ul>
<h3 id="userpy">user.py</h3>
<ul>
<li><code>IsAccountOwner</code>：判断用户是否是目标用户</li>
</ul>
<h2 id="_25">视图</h2>
<p>视图即后端所提供的API，这部分文件全部在backend/saiblo/views中，写法由Django REST框架决定，遵循REST规范，此处将它们罗列一遍毫无意义。</p>
<p>需要注意的是用到的基类可能是混合的，对于一个完整的REST API，视图类继承自<code>rest_framework.viewsets.ModelViewSet</code>，但是对于一些孤立的API，可能继承自<code>APIView</code>，对于那些不支持全部API，只需要部分功能的类，我采用了多继承的方法，即继承<code>viewsets.GenericViewSet</code>与多个<code>viewsets.mixins.SomeModeMixin</code>，其中的<code>Some</code>为某个具体操作，这样一来可以达到自行组合API的效果。</p>
<h2 id="_26">序列化</h2>
<p>为了将模型数据序列化成为json数据，用到了serializers，所有的serializer均保存在backend/saiblo/serializers文件夹中，且继承自<code>rest_framework.serializers.ModelSerializer</code>，用到了嵌套序列化等复杂结构，使用了视图参数等不优雅的写法，总的来说仍然是遵循着Django REST的支持完成，此处也没有必要罗列一遍。</p>
<p>需要强调的是要注意时间的序列化，前端在开发过程中出现了RFC_2822与RFC_3339标准的混用，后端目前的设定是输入格式为两种标准均支持，输出格式为RFC_2822，这些格式字符串均定义在backend/saiblo/utils/string.py中，维护时建议遵循原有风格。</p>
<h2 id="_27">信号</h2>
<p>由于信号功能在开发到一半时才学会，所以设计上可能不能保证绝对合理，某些可以采用信号完成的内容在别处完成了，并且信号的设计可能也不优雅，如果有需要可以加强对信号的集成。</p>
<p>信号全部定义在backend/saiblo/signals文件夹中，确切地说与其叫“信号”不如叫“槽”更合适，官方文档推荐把这些槽函数放置于signals文件夹中，我按照该建议完成，但是可以理解成这是一个slots文件夹。</p>
<p>在该文件夹中，signal.py定义了人为新增的信号，包含以下信号：</p>
<ol>
<li>match_prepared：天梯生成的自动对局准备完毕时触发</li>
<li>fighter_changed：天梯AI变更时触发</li>
<li>activate_code_changed：游戏出战AI变更时触发，疑似冗余</li>
<li>ladder_match_judged：天梯对局被评测完成时触发</li>
</ol>
<p>下面是所有的槽函数。</p>
<h3 id="auto_deal">auto_deal</h3>
<ul>
<li>文件：application.py</li>
<li>信号：post_save</li>
<li>来源：Application</li>
<li>效果：如果是created则处理自动处理申请(不允许任何人加入或自动通过申请)的逻辑，如果不是则处理通过申请的逻辑。</li>
</ul>
<h3 id="remove_user">remove_user</h3>
<ul>
<li>文件：application.py</li>
<li>信号：post_delete</li>
<li>来源：Application</li>
<li>效果：在删除申请时移除对应的用户</li>
</ul>
<h3 id="add_compile_task">add_compile_task</h3>
<ul>
<li>文件：code.py</li>
<li>信号：post_save</li>
<li>来源：Code</li>
<li>效果：处理向评测机发起代码编译任务的逻辑</li>
</ul>
<h3 id="update_game_ladder">update_game_ladder</h3>
<ul>
<li>文件：code.py</li>
<li>信号：post_save</li>
<li>来源：ActiveCode</li>
<li>效果：在用户添加出战AI时新增比赛AI时生成对应的<code>Participation</code>，处理用户出战AI修改</li>
</ul>
<h3 id="delete_game_ladder">delete_game_ladder</h3>
<ul>
<li>文件：code.py</li>
<li>信号：post_delete</li>
<li>来源：ActiveCode</li>
<li>效果：在游戏退出游戏天梯时删除相应的<code>Participation</code></li>
</ul>
<h3 id="deal_code_change">deal_code_change</h3>
<ul>
<li>文件：contest.py</li>
<li>信号：fighter_changed</li>
<li>来源：Participation</li>
<li>效果：在用户更换天梯AI时给出天梯惩罚分，目前是减100</li>
</ul>
<h3 id="add_game_contest">add_game_contest</h3>
<ul>
<li>文件：game.py</li>
<li>信号：post_save</li>
<li>来源：Game</li>
<li>效果：在新建Game时添加对应的隐性比赛</li>
</ul>
<h3 id="update_ladder">update_ladder</h3>
<ul>
<li>文件：group.py</li>
<li>信号：m2m_changed</li>
<li>来源：Group.members.through</li>
<li>效果：在小组离开用户时，将他在该小组的所有比赛的信息删除</li>
</ul>
<h3 id="deal_application">deal_application</h3>
<ul>
<li>文件：group.py</li>
<li>信号：post_save</li>
<li>来源：Group</li>
<li>效果：在创建小组时为创建者生成隐性申请，在设置为不允许任何人加入时删除所有申请，在设置成自动通过申请时通过所有现有申请</li>
</ul>
<h3 id="send_ladder_match">send_ladder_match</h3>
<ul>
<li>文件：match.py</li>
<li>信号：match_prepared</li>
<li>来源：Match</li>
<li>效果：在新的对局生成时将它传给评测机</li>
</ul>
<h3 id="update_ladder_1">update_ladder</h3>
<ul>
<li>文件：match.py</li>
<li>信号：ladder_match_judged</li>
<li>来源：Match</li>
<li>效果：在评测完对局后处理对局选手天体分数的变更</li>
</ul>
<h2 id="_28">定时任务</h2>
<p>为了实现后端定时发起天梯对局的效果，用到了Django-crontab设置定时任务，任务的执行函数在backend/saiblo/tasks文件夹中，目前该文件夹只有ladder.py，包含以下内容。</p>
<h3 id="name_to_match_creator">NAME_TO_MATCH_CREATOR</h3>
<p>一个字典常量，为不同赛制绑定相应对局生成函数，这里理应允许赛事方自行制定赛制并接入。</p>
<h3 id="auto_match">auto_match</h3>
<p>被定时调用的函数，每隔一个固定时间会在这里生成天体对局，时间间隔设置在backend/app/settings.py的<code>CRONJOBS</code>列表中，具体用法参加Django-crontab文档。</p>
<h3 id="randon_create_match">randon_create_match</h3>
<p>暂时使用的随机生成对局的函数，会自动在比赛达到所需要人数下限后生成对局，随机在参赛AI中进行抽取。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../judger/" class="btn btn-neutral float-right" title="评测端">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../arch/" class="btn btn-neutral" title="平台架构"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../arch/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../judger/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
